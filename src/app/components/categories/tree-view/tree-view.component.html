<!-- <div class="tree-container">
    <p-tree [value]="categories()">
      <ng-template let-node pTemplate="default">
        <div class="node-content">
          <span>{{ node.label }}</span>
        </div>
      </ng-template>
    </p-tree>
  </div>
   -->

<!-- 
   <div class="tree-container">
    <p-tree 
      [value]="categories()" 
      [lazy]="true" 
      (onNodeExpand)="loadNode($event)" 
      selectionMode="single"
    >
      <ng-template let-node pTemplate="default">
        <div class="node-content">
          <span>{{ node.label }}</span>
          <button 
            pButton 
            type="button" 
            icon="pi pi-list" 
            class="icon-btn" 
            (click)="showAttributesDialog(node)" 
            title="نمایش ویژگی‌ها"
            [disabled]="!node.data?.id || showDialog()"
          ></button>
        </div>
      </ng-template>
    </p-tree>
  </div>
  
  <p-dialog
    header="ویژگی‌های {{ selectedNode()?.label }}"
    [(visible)]="showDialog"
    [modal]="true"
    [style]="{ width: '30rem' }"
    [draggable]="false"
    [resizable]="false"
    styleClass="attributes-dialog"
  >
    <div *ngIf="selectedNode()?.data.attributes?.length; else noAttributes">
      <div *ngFor="let attr of selectedNode()?.data.attributes; trackBy: trackByAttribute">
        {{ attr.attributeName }} ({{ attr.attributeType }}) 
        {{ attr.inherited ? '(ارث‌بری‌شده)' : '' }} 
        {{ attr.required ? '(اجباری)' : '' }}
      </div>
    </div>
    <ng-template #noAttributes>
      <div class="no-attributes">هیچ ویژگی‌ای وجود ندارد</div>
    </ng-template>
  </p-dialog>
 -->



 <div class="tree-container">
  <p-tree
    [value]="categories()"
    [lazy]="true"
    (onNodeExpand)="loadNode($event)"
    selectionMode="single"
    role="tree"
    aria-label="درخت دسته‌بندی‌ها"
  >
    <ng-template let-node pTemplate="default">
      <div class="node-content" [attr.aria-expanded]="node.expanded ? 'true' : 'false'" role="treeitem">
        <span class="node-label">
          @if (node.children && node.children.length) {
            <i
              class="pi"
              [ngClass]="node.expanded ? 'pi-chevron-up' : 'pi-chevron-down'"
              (click)="toggleNode(node)"
              aria-label="باز و بسته کردن زیرمجموعه‌ها"
            ></i>
          }
          {{ node.label }}
        </span>
        <button
          pButton
          type="button"
          icon="pi pi-list"
          class="icon-btn"
          (click)="showAttributesDialog(node)"
          title="نمایش ویژگی‌ها"
          [disabled]="!node.data?.id || showDialog()"
          aria-label="نمایش ویژگی‌های دسته‌بندی"
        ></button>
      </div>
    </ng-template>
  </p-tree>
</div>

<p-dialog
  header="ویژگی‌های {{ selectedNode()?.label }}"
  [(visible)]="showDialog"
  [modal]="true"
  [style]="{ width: '30rem' }"
  [draggable]="false"
  [resizable]="false"
  styleClass="attributes-dialog"
  role="dialog"
  aria-label="دیالوگ ویژگی‌های دسته‌بندی"
>
  @if (selectedNode()?.data.attributes?.length) {
    @for (attr of selectedNode()?.data.attributes; track trackByAttribute($index, attr)) {
      <div class="attribute-item">
        {{ attr.attributeName }} ({{ attr.attributeType }})
        @if (attr.inherited) {
          <span>(ارث‌بری‌شده)</span>
        }
        @if (attr.required) {
          <span>(اجباری)</span>
        }
      </div>
    }
  } @else {
    <div class="no-attributes">هیچ ویژگی‌ای وجود ندارد</div>
  }
</p-dialog>