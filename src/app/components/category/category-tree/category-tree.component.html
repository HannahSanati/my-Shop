<div class="tree-container">
  <p-tree
    [value]="categories()"
    [lazy]="true"
    (onNodeExpand)="loadNode($event)"
    (onNodeSelect)="selectNode($event)"
    selectionMode="single"
  >
    <ng-template let-node pTemplate="default">
      <div class="node-content" [attr.aria-expanded]="node.expanded ? 'true' : 'false'" role="treeitem">
        <span class="node-label">
          @if (node.children && node.children.length) {
            <i class="pi" [ngClass]="node.expanded ? 'pi-chevron-up' : 'pi-chevron-down'" (click)="toggleNode(node)" aria-label="باز و بسته کردن زیرمجموعه‌ها"></i>
          }
          {{ node.label }}
        </span>
        <div class="node-actions">
          <button
            pButton
            type="button"
            icon="pi pi-list"
            class="show-attributes-btn"
            (click)="showAttributesDialog(node)"
            title="نمایش ویژگی‌ها"
            [disabled]="!node.data?.id || showDialog()"
            aria-label="نمایش ویژگی‌های دسته‌بندی"
          ></button>
          <button
            pButton
            type="button"
            icon="pi pi-pencil"
            class="edit-btn"
            (click)="selectNode({ node })"
            title="ویرایش دسته‌بندی"
            [disabled]="!node.data?.id"
            aria-label="ویرایش دسته‌بندی"
          ></button>
          <button
            pButton
            type="button"
            icon="pi pi-trash"
            class="p-button-danger delete-btn"
            (click)="deleteCategory(node.data.id)"
            title="حذف دسته‌بندی"
            [disabled]="!node.data?.id"
            aria-label="حذف دسته‌بندی"
          ></button>
        </div>
      </div>
    </ng-template>
  </p-tree>
</div>

<p-dialog
  header="ویژگی‌های {{ selectedNode()?.label }}"
  [(visible)]="showDialog"
  [modal]="true"
  [style]="{ width: '30rem' }"
  [draggable]="false"
  [resizable]="false"
  [blockScroll]="true"
  styleClass="attributes-dialog"
  (onShow)="onDialogShow()"
  (onHide)="onDialogHide()"
>
  @if (selectedNode()?.data.attributes?.length) {
    @for (attr of selectedNode()?.data.attributes; track trackByAttribute($index, attr)) {
      <div class="attribute-item">
        {{ attr.attributeName }} ({{ attr.attributeType }})
        @if (attr.inherited) {
          <span>(ارث‌بری‌شده)</span>
        }
        @if (attr.required) {
          <span>(اجباری)</span>
        }
      </div>
    }
  } @else {
    <div class="no-attributes">هیچ ویژگی‌ای وجود ندارد</div>
  }
</p-dialog>